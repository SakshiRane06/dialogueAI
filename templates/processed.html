{% extends "base.html" %}

{% block title %}DialogueAI - Document Processed{% endblock %}

{% block content %}
<div class="card">
    <div style="text-align: center; margin-bottom: 2rem;">
        <div style="font-size: 4rem; color: var(--success-color); margin-bottom: 1rem;">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2 style="color: var(--text-primary); font-weight: 600;">
            Document Successfully Processed!
        </h2>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">
            <strong>{{ filename }}</strong> has been analyzed and is ready for dialogue generation.
        </p>
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-value">{{ stats.characters | default(0) | round | int }}</div>
            <div class="stat-label">Characters</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ stats.chunks | default(0) }}</div>
            <div class="stat-label">Text Chunks</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ stats.embedding_model | truncate(12, True) | default('N/A') }}</div>
            <div class="stat-label">Embedding Model</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">
                {% if stats.using_openai %}
                    <i class="fas fa-robot" style="color: var(--primary-color);"></i>
                {% else %}
                    <i class="fas fa-cog" style="color: var(--warning-color);"></i>
                {% endif %}
            </div>
            <div class="stat-label">
                {% if stats.using_openai %}OpenAI{% else %}Local Model{% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 2rem; color: var(--text-primary); text-align: center;">
        <i class="fas fa-magic"></i> Generate Your Dialogue
    </h3>
    
    <form action="/generate" method="post" id="generateForm">
        <!-- Hidden fields to pass document info -->
        <input type="hidden" name="file_id" value="{{ file_id }}">
        <input type="hidden" name="filename" value="{{ filename }}">
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-bullseye"></i> What do you want to learn from this document?
            </label>
            <textarea 
                name="user_goal" 
                class="form-control" 
                placeholder="e.g., 'Explain machine learning concepts in simple terms' or 'Help me understand the key benefits and challenges'"
                rows="3"
                required
                style="resize: vertical; min-height: 80px;"
            ></textarea>
            <small style="color: var(--text-secondary); font-size: 0.85rem;">
                Be specific about what you'd like to learn or understand from the document.
            </small>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-volume-up"></i> Conversation Tone
                </label>
                <select name="tone" class="form-control">
                    <option value="conversational">Conversational</option>
                    <option value="professional">Professional</option>
                    <option value="casual">Casual</option>
                    <option value="academic">Academic</option>
                    <option value="friendly">Friendly</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-graduation-cap"></i> Difficulty Level
                </label>
                <select name="difficulty" class="form-control">
                    <option value="beginner">Beginner</option>
                    <option value="intermediate" selected>Intermediate</option>
                    <option value="advanced">Advanced</option>
                    <option value="expert">Expert</option>
                </select>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn" onclick="showLoading(this)">
                <i class="fas fa-comments"></i>
                Generate Dialogue
            </button>
        </div>
    </form>
</div>

<div class="card">
    <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">
        <i class="fas fa-lightbulb"></i> Tips for Better Results
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
        <div style="background: rgba(102, 126, 234, 0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--primary-color);">
            <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-target"></i> Be Specific
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                Instead of "explain this document," try "help me understand the main benefits and implementation challenges of RAG systems."
            </p>
        </div>
        
        <div style="background: rgba(16, 185, 129, 0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--success-color);">
            <h4 style="color: var(--success-color); margin-bottom: 0.5rem;">
                <i class="fas fa-users"></i> Think About Your Audience
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                Choose the right difficulty level and tone based on who would benefit from this dialogue.
            </p>
        </div>
        
        <div style="background: rgba(245, 158, 11, 0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--warning-color);">
            <h4 style="color: var(--warning-color); margin-bottom: 0.5rem;">
                <i class="fas fa-clock"></i> Processing Time
            </h4>
            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                Dialogue generation typically takes 10-30 seconds depending on document complexity and API response time.
            </p>
        </div>
    </div>
</div>

<div style="text-align: center; margin-top: 2rem;">
    <a href="/" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i>
        Upload Another Document
    </a>
</div>

<script>
// Auto-focus on the goal textarea
document.addEventListener('DOMContentLoaded', function() {
    const goalTextarea = document.querySelector('textarea[name="user_goal"]');
    if (goalTextarea) {
        goalTextarea.focus();
    }
    
    // Character counter for goal textarea
    goalTextarea.addEventListener('input', function() {
        const length = this.value.length;
        const maxLength = 500;
        
        if (length > maxLength * 0.8) {
            let counter = this.parentElement.querySelector('.char-counter');
            if (!counter) {
                counter = document.createElement('div');
                counter.className = 'char-counter';
                counter.style.cssText = 'font-size: 0.8rem; color: var(--text-secondary); text-align: right; margin-top: 0.5rem;';
                this.parentElement.appendChild(counter);
            }
            
            counter.textContent = `${length}/${maxLength}`;
            counter.style.color = length > maxLength ? 'var(--error-color)' : 'var(--text-secondary)';
        }
    });
});
</script>
{% endblock %}
